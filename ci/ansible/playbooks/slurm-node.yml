---
- hosts: all
  become: yes
  become_user: root
  pre_tasks:
    - name: "Update apt cache if needed"
      apt: update_cache=yes cache_valid_time=3600
      when: ansible_os_family == 'Debian'
  tasks:
        - package: name=nfs-utils state=present
        - service: name=rpcbind state=started
        - mount: src={{nfs_master}}:/zdata name=/zdata state=mounted fstype=nfs
        - group: name=munge gid=127 state=present
        - user: name=munge uid=120 state=present shell=/sbin/nologin createhome=no system=yes home=/var/run/munge group=munge comment="Runs Uid 'N' Gid Emporium"

- hosts: all
  become: yes
  become_user: root
  vars:
      pip_version: "8.1.*"
      slurm_master: "localhost"
      slurm_clustername: "default"
  roles:
      - { role: zenotech.slurm, is_slurm_master: false, is_slurm_node: true }
